# Подключение к серийной консоли виртуальной машины по SSH

{% include [key-without-password-alert](../../../_includes/compute/key-without-password-alert.md) %}

После [включения доступа](./index.md), вы можете подключиться к серийной консоли для взаимодействия с [ВМ](../../concepts/vm.md). Перед [подключением](../../../glossary/ssh-keygen.md) к серийной консоли внимательно ознакомьтесь с разделом [{#T}](#security).

## Безопасность {#security}

{% include [sc-warning](../../../_includes/compute/serial-console-warning.md) %}

Важным моментом при удаленном доступе является защита от [атак посредника (MITM-атак)](https://ru.wikipedia.org/wiki/Атака_посредника). Защититься от MITM-атак можно, используя шифрование между клиентом и сервером.

Установить безопасное подключение можно следующими способами:
* Вы можете скачивать текущий [SHA256 Fingerprint](https://{{ s3-storage-host }}/cloud-certs/serialssh-fingerprint.txt) (отпечаток) SSH-ключа перед каждым подключением к ВМ.

  При первом подключении к ВМ клиент сообщает отпечаток SSH-ключа и ожидает решения по установке соединения:
  * `YES` — установить соединение.
  * `NO` — отказаться.

  Убедитесь, что отпечаток по ссылке совпадает с отпечатком, полученным от клиента.
* Вы можете скачивать публичный [SSH-ключ](https://{{ s3-storage-host }}/cloud-certs/serialssh-knownhosts) хоста перед каждым подключением к серийной консоли.

  Используйте полученный публичный SSH-ключ при подключении к серийной консоли.

  Рекомендуемые параметры запуска:

  ```bash
  ssh -o ControlPath=none -o IdentitiesOnly=yes -o CheckHostIP=no -o StrictHostKeyChecking=yes -o UserKnownHostsFile=./serialssh-knownhosts -p 9600 -i ~/.ssh/<имя_закрытого_SSH-ключа> <идентификатор_ВМ>.<имя_пользователя>@{{ serial-ssh-host }}
  ```

  Публичный SSH-ключ хоста в будущем может быть изменен.

Чаще сверяйтесь с указанными файлами. Скачивайте данные файлы только по протоколу HTTPS, предварительно убедившись в валидности сертификата сайта `https://{{ s3-storage-host }}`. Если из-за проблем с сертификатом сайт не может обеспечить безопасное шифрование ваших данных, браузер предупреждает об этом.

## Подключиться к серийной консоли {#connect-to-serial-console}

{% note info %}

Работа серийной консоли зависит от настроек используемой операционной системы. Сервис {{ compute-name }} обеспечивает канал между пользователем и COM-портом ВМ и не гарантирует стабильность работы консоли со стороны ОС.

{% endnote %}

Выполните команду:

```bash
ssh -t -p 9600 -o IdentitiesOnly=yes -i <путь_к_закрытому_SSH-ключу> <идентификатор_ВМ>.<имя_пользователя>@{{ serial-ssh-host }}
```

Где: 
  * `путь_к_закрытому_SSH-ключу` — путь к закрытой части [SSH-ключа](../vm-connect/ssh.md#creating-ssh-keys), созданного при [создании ВМ](../vm-create/create-linux-vm.md).
  * `идентификатор_ВМ` — идентификатор виртуальной машины. Как получить идентификатор ВМ читайте в разделе [{#T}](../vm-info/get-info.md).
  * `имя_пользователя` — имя администратора, указанное при создании ВМ.

Пример команды подключения:

```bash
ssh -t -p 9600 -o IdentitiesOnly=yes -i ~/.ssh/id_ed25519 fhm0b28lgfp4********.yc-user@{{ serial-ssh-host }}
```

Вы также можете подключиться к серийной консоли с помощью [SSH-ключей для других пользователей](../vm-connect/ssh.md#vm-authorized-keys).

### Решение проблем {#troubleshooting}

* Если после подключения к серийной консоли на экране ничего не отображается:
  * Нажмите на клавиатуре клавишу **Enter**.
  * Перезапустите ВМ (для ВМ, созданных до 22 февраля 2019 года).
* Если ОС запрашивает данные пользователя для доступа на ВМ, укажите имя пользователя (логин) и пароль.
  * На ВМ с Linux предварительно создайте пароль для пользователя. Выполните команду `sudo passwd <имя_пользователя>`. Подробнее см. в разделе [Начало работы с серийной консолью](./index.md#linux-configuration).
  * На ВМ с Windows потребуется ввести логин, домен (имя ВМ) и пароль. Подробнее см. в разделе [Запустить командную оболочку в Windows SAC](./windows-sac.md).
* Если при подключении возникает ошибка `Warning: remote host identification has changed!`, выполните команду `ssh-keygen -R <IP-адрес_ВМ>`.

## Отключиться от серийной консоли {#turn-off-serial-console}

Чтобы отключиться от серийной консоли:
1. Нажмите на клавиатуре клавишу **Enter**.
1. Введите последовательно символы `~.`.