# Integration with the {{ license-manager }} API

If you created a [subscription](../concepts/subscription.md) within one of these service plans:
* `Subscription`: Set up integration with the [{{ license-manager }} API](../license-manager/api-ref/index.md) for your subscription to work properly.
* `PAYG`: The user will automatically switch to this service plan as soon as they unlink the subscription from a resource or as soon as the subscription expires. You can set up integration with the {{ license-manager }} API if needed.

{% list tabs group=service %}

- {{ compute-name }} {#compute}

   1. {% include [lmi-step-1](../../_includes/marketplace/lmi-step-1.md) %}

   1. Implement the following steps in your product code:

      1. {% include [lmi-step-2](../../_includes/marketplace/lmi-step-2.md) %}

      1. {% include [lmi-step-3](../../_includes/marketplace/lmi-step-3.md) %}

- {{ managed-k8s-name }} {#managed-k8s}

   1. {% include [lmi-step-1](../../_includes/marketplace/lmi-step-1.md) %}

   1. Implement the following steps in your product code:

      1. Getting the ID of application installation to the {{ k8s }} cluster and linking it to the subscription. [Sample code](https://github.com/yandex-cloud-examples/yc-marketplace-k8s-check-licenses/tree/main).

      1. {% include [lmi-step-2](../../_includes/marketplace/lmi-step-2.md) %}

      1. {% include [lmi-step-3](../../_includes/marketplace/lmi-step-3.md) %}

- {{ cloud-apps-name }} {#cloud-apps}

   1. {% include [lmi-step-1](../../_includes/marketplace/lmi-step-1.md) %}

   1. Implement the following steps in your product code:

      1. {% include [lmi-step-2](../../_includes/marketplace/lmi-step-2.md) %}

      1. {% include [lmi-step-3](../../_includes/marketplace/lmi-step-3.md) %}

- SaaS {#saas}

   1. Create:

      * Page to redirect the user to. When redirecting the user, a query string will provide the token generated by {{ yandex-cloud }} in the `token` parameter. The token is valid for 10 minutes. Use this time to authorize the user and assign them a unique ID to be later linked to the subscription.
      * [Service account](../../iam/operations/sa/create.md). The account will be used to link the user's unique ID to the subscription:
         1. Log in to the [{{ marketplace-short-name }} partner dashboard]({{ link-cloud-partners }}).
         1. Open the **{{ ui-key.yacloud_portal.portal.publisher-users }}** section.
         1. Click **{{ ui-key.yacloud_portal.acl.common.action_via-federation }}**.
         1. In the window that opens, specify the [service account ID](../../iam/operations/sa/get-id.md) and click **{{ ui-key.yacloud_portal.common.action_add }}**.
         1. Find the service account in the list and click ![image](../../_assets/marketplace/three_dots.png) â†’ **{{ ui-key.yacloud_portal.common.action_change }}**.
         1. In the window that opens, click **+ Add role**, select the `license-manager.saasSubscriptionSupervisor` role, and click **Save**.
         1. Authenticate with the {{ license-manager }} API as a service account. For authentication, use an [IAM token](../../iam/concepts/authorization/iam-token.md).

   1. {% include [lmi-step-1](../../_includes/marketplace/lmi-step-1.md) %}

   1. Implement the following steps in your product code:

      1. Getting a unique user ID to be linked to the subscription.

      1. Linking the unique user ID to the subscription.

         You can link an ID to a subscription using the [ensure](../license-manager/saas/api-ref/Lock/ensure.md) REST API method for the [Lock](../license-manager/saas/api-ref/Lock/index.md) resource or the [LockService/Ensure](../license-manager/saas/api-ref/grpc/lock_service.md#Ensure) gRPC API call.

      1. Regular checks that your linked subscription is active.

         To get up-to-date information about a linked subscription, use the [get](../license-manager/saas/api-ref/Lock/get.md) REST API method for the [Lock](../license-manager/saas/api-ref/Lock/index.md) resource or the [LockService/Get](../license-manager/saas/api-ref/grpc/lock_service.md#Get) gRPC API call.

         {% note info %}

         Please note that the user can unlink an ID from the subscription and link another one to it. Make sure your code can handle cases like this correctly.

         {% endnote %}

      1. {% include [lmi-step-3](../../_includes/marketplace/lmi-step-3.md) %}

{% endlist %}
